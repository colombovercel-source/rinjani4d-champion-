<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin RINJANI4D</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#0b1c2d;
  font-family:Arial;
  color:#fff;
  padding:20px;
}
h2{color:#d4af37}
input,button{
  padding:8px;
  margin-top:5px;
}
button{
  background:#d4af37;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
.card{
  background:#132c44;
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
}
.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.pending{background:#2b3e55}
.approved{background:#1e7f43}
.rejected{background:#8b1e1e}
</style>
</head>

<body>

<h2>Admin Login</h2>
<div id="login">
  <input id="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none">
  <h2>Dashboard Admin</h2>
  <button onclick="logout()">Logout</button>
  <div id="list"></div>
</div>

<script>
const SUPABASE_URL="https://PROJECT_ID.supabase.co"
const SUPABASE_KEY="SERVICE_ROLE_OR_ANON_KEY"
const ADMIN_EMAIL="admin@rinjani4d.com"

const supabase=supabaseJs.createClient(SUPABASE_URL,SUPABASE_KEY)

async function login(){
  const email=document.getElementById("email").value
  const password=document.getElementById("password").value

  const {data,error}=await supabase.auth.signInWithPassword({email,password})
  if(error || data.user.email!==ADMIN_EMAIL){
    alert("Akses ditolak")
    await supabase.auth.signOut()
    return
  }

  document.getElementById("login").style.display="none"
  document.getElementById("dashboard").style.display="block"
  load()
}

async function logout(){
  await supabase.auth.signOut()
  location.reload()
}

async function load(){
  const {data}=await supabase
    .from("bonus_claims")
    .select("*")
    .order("created_at",{ascending:false})

  document.getElementById("list").innerHTML=data.map(c=>`
    <div class="card">
      <b>${c.user_id}</b><br>
      Deposit: Rp ${c.deposit}<br>
      <span class="badge ${c.status.toLowerCase()}">${c.status}</span><br>
      <input id="r-${c.id}" placeholder="Alasan reject">
      <button onclick="approve('${c.id}')">Approve</button>
      <button onclick="reject('${c.id}')">Reject</button>
    </div>
  `).join("")
}

async function approve(id){
  await supabase.from("bonus_claims")
  .update({status:"Approved",reject_reason:null})
  .eq("id",id)
}

async function reject(id){
  const r=document.getElementById("r-"+id).value
  if(!r){alert("Isi alasan");return}
  await supabase.from("bonus_claims")
  .update({status:"Rejected",reject_reason:r})
  .eq("id",id)
}

supabase.channel("admin-live")
.on("postgres_changes",{event:"*",schema:"public",table:"bonus_claims"},load)
.subscribe()
</script>

</body>
</html>
